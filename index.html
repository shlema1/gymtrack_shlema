<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Track DEBUG</title>
    <style>
        body { font-family: monospace; background: #121212; color: #fff; text-align: center; padding: 20px; }
        .box { background: #1e1e1e; border: 1px solid #333; padding: 15px; margin: 10px auto; max-width: 600px; border-radius: 8px; }
        button { padding: 15px; width: 100%; background: #2196F3; color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 5px; }
        #log { 
            background: #000; color: #0f0; 
            text-align: left; padding: 10px; 
            height: 300px; overflow-y: scroll; 
            font-size: 12px; border: 1px solid #0f0;
            margin-top: 10px;
        }
        .val-box { font-size: 24px; color: #ffeb3b; font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

    <h1>üîç DEBUG MODE</h1>
    
    <div class="box">
        <button onclick="connectBLE()">1. P≈òIPOJIT BLE</button>
        <div id="status">Odpojeno</div>
    </div>

    <div class="box">
        <div>≈ΩIV√Å DATA (Zpracovan√°):</div>
        <div id="liveDisplay" class="val-box">--</div>
    </div>

    <div class="box">
        <div>SUROV√Å DATA (To co chod√≠ z ƒçipu):</div>
        <div id="log">Zde se budou vypisovat data...</div>
    </div>

    <script>
        const sUUID = "12345678-1234-1234-1234-123456789012";
        const cCmd = "87654321-4321-4321-4321-210987654321";
        const cData = "abcdef01-1234-5678-1234-56789abcdef0";
        
        async function connectBLE() {
            try {
                log("Hled√°m za≈ô√≠zen√≠ GymCounter...");
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: "Gym" }],
                    optionalServices: [sUUID]
                });

                log("P≈ôipojuji k GATT serveru...");
                const server = await device.gatt.connect();
                
                log("Hled√°m slu≈æbu...");
                const service = await server.getPrimaryService(sUUID);
                
                log("Hled√°m charakteristiku pro data...");
                const charData = await service.getCharacteristic(cData);

                log("Zap√≠n√°m notifikace...");
                await charData.startNotifications();
                charData.addEventListener('characteristicvaluechanged', handleData);

                document.getElementById("status").innerText = "üü¢ P≈òIPOJENO!";
                log("‚úÖ HOTOVO! ƒåek√°m na data...");

            } catch (error) {
                log("‚ùå CHYBA: " + error);
            }
        }

        function handleData(event) {
            const decoder = new TextDecoder();
            const value = decoder.decode(event.target.value);
            
            // 1. Vypi≈° do logu v≈°echno
            log("P≈ò√çCHOZ√ç: " + value);

            // 2. Zkus naj√≠t LIVE data
            if (value.startsWith("LIVE:")) {
                const num = value.split(":")[1];
                document.getElementById("liveDisplay").innerText = num;
            }
        }

        function log(text) {
            const logBox = document.getElementById("log");
            const time = new Date().toLocaleTimeString();
            logBox.innerHTML = `[${time}] ${text}<br>` + logBox.innerHTML;
        }
    </script>
</body>
</html>
