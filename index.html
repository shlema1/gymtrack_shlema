<!DOCTYPE html>
<html>
<body>
<h2>GymTrack</h2>

<button onclick="send('CAL_START')">Cal Start</button>
<button onclick="send('CAL_END')">Cal End</button><br><br>

<button onclick="send('START_SET')">Start Set</button>
<button onclick="send('STOP_SET')">Stop Set</button>

<pre id="out"></pre>

<script>
let dev, srv, cmd, status;

async function connect(){
  dev = await navigator.bluetooth.requestDevice({
    filters:[{name:"GymTrack"}],
    optionalServices:["4fafc201-1fb5-459e-8fcc-c5c9c331914b"]
  });
  const g = await dev.gatt.connect();
  srv = await g.getPrimaryService("4fafc201-1fb5-459e-8fcc-c5c9c331914b");
  cmd = await srv.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b26a8");
  status = await srv.getCharacteristic("1c95d5e3-d8f7-413a-bf3d-7a2e5d7be87e");
  status.startNotifications();
  status.oncharacteristicvaluechanged = e=>{
    out.textContent = new TextDecoder().decode(e.target.value);
  };
}

async function send(c){
  if(!cmd) await connect();
  await cmd.writeValue(new TextEncoder().encode(c));
}
</script>
</body>
</html>
